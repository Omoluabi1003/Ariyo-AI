// Auto-generated companion for radioStations.ts to keep runtime JS available in the legacy static build.
// Provides mergedRadioStations and validateRadioStations globals without altering the original radioStations definition.

const radioStationsNew = [
  { name: 'Rhythm FM 93.7 Lagos', type: 'Live Radio', url: 'https://stream.radio.co/s61726bb1d/listen', thumbnail: '' },
  { name: 'Cool FM 96.9 Lagos', type: 'Live Radio', url: 'https://ais.streamonkey.net/coolfm_lagos-mp3', thumbnail: '' },
  { name: 'Beat FM 99.9 Lagos', type: 'Live Radio', url: 'https://stream.radio.co/s5f042e61a/listen', thumbnail: '' },
  { name: 'City FM 105.1 Lagos', type: 'Live Radio', url: 'https://city1051.radio12345.com/stream', thumbnail: '' },
  { name: 'Inspiration FM 92.3 Lagos', type: 'Live Radio', url: 'https://stream.radio.co/s325f19c96/listen', thumbnail: '' },
  { name: 'Brila FM 88.9 Lagos', type: 'Live Radio', url: 'https://ice3.securenetsystems.net/BRILAFM', thumbnail: '' },
  { name: 'Smooth 98.1 FM Lagos', type: 'Live Radio', url: 'https://stream.radio.co/s7d3a04a37/listen', thumbnail: '' },
  { name: 'Soundcity 98.5 Lagos', type: 'Live Radio', url: 'https://stream.radio.co/s21132626e/listen', thumbnail: '' },
  { name: 'Nigeria Info FM 99.3 Lagos', type: 'Live Radio', url: 'https://stream.radio.co/s87779d714/listen', thumbnail: '' },
  { name: 'Wazobia FM 95.1 Lagos', type: 'Live Radio', url: 'https://stream.radio.co/s4c93f0b24/listen', thumbnail: '' },
  { name: 'Classic FM 97.3 Lagos', type: 'Live Radio', url: 'https://stream.radio.co/s5145b2311/listen', thumbnail: '' },
  { name: 'Top Radio 90.9 Lagos', type: 'Live Radio', url: 'https://stream.radio.co/s117769268/listen', thumbnail: '' },
  { name: 'Urban 96 FM Lagos', type: 'Live Radio', url: 'https://stream.radio.co/s698d28713/listen', thumbnail: '' },
  { name: 'Bond FM 92.9 Lagos', type: 'Live Radio', url: 'https://stream.radio.co/s653c30953/listen', thumbnail: '' },
  { name: 'Faaji FM 106.5 Lagos', type: 'Live Radio', url: 'https://stream.radio.co/s6a9924515/listen', thumbnail: '' },
  { name: 'Radio One 103.5 Lagos', type: 'Live Radio', url: 'https://stream.radio.co/s21132626e/listen', thumbnail: '' },
  { name: 'Freedom FM 99.5 Lagos', type: 'Live Radio', url: 'https://stream.radio.co/s78174f857/listen', thumbnail: '' },
  { name: 'Eko FM 89.7 Lagos', type: 'Live Radio', url: 'https://stream.radio.co/s769b7f516/listen', thumbnail: '' },
  { name: 'Radio Lagos 107.5 FM', type: 'Live Radio', url: 'https://stream.radio.co/s117769268/listen', thumbnail: '' },
  { name: 'Traffic Radio 96.1 FM Lagos', type: 'Live Radio', url: 'https://stream.radio.co/s627197125/listen', thumbnail: '' },
  { name: 'Wazobia FM - Lagos', type: 'Live Radio', url: 'https://wazobiafm.com/lagos.m3u', thumbnail: 'https://wazobiafm.com/wp-content/uploads/2020/03/wazobia-logo.png' },
  { name: 'Cool FM - Abuja', type: 'Live Radio', url: 'http://coolfm.abuja.stream.cdnstream1.com/coolfm_abuja', thumbnail: 'https://coolfm.ng/wp-content/uploads/2020/02/coolfm-logo.png' },
  { name: 'Metro FM - Johannesburg', type: 'Live Radio', url: 'http://antbiome-jhb-01.radio.co.za:80/MetroFM', thumbnail: 'https://www.sabc.co.za/sabc/wp-content/uploads/2020/03/metro-fm-logo.png' },
  { name: '5FM - Johannesburg', type: 'Live Radio', url: 'http://antbiome-jhb-01.radio.co.za:80/5FM', thumbnail: 'https://www.sabc.co.za/sabc/wp-content/uploads/2020/03/5fm-logo.png' },
  { name: 'Capital FM - Nairobi', type: 'Live Radio', url: 'https://stream.capitalfm.co.ke/capitalfm', thumbnail: 'https://capitalfm.co.ke/wp-content/uploads/2020/01/capital-fm-logo.png' },
  { name: 'Joy FM - Accra', type: 'Live Radio', url: 'https://stream.zeno.fm/8v8nq5v8m0quv', thumbnail: 'https://myjoyonline.com/wp-content/uploads/2020/03/joy-fm-logo.png' },
  { name: 'BBC Radio 1 - London', type: 'Live Radio', url: 'http://as-hls-uk-live.akamaized.net/pool_904/live/uk/bbc_radio_one/bbc_radio_one.isml/bbc_radio_one-audio=320000.m3u8', thumbnail: 'https://www.bbc.co.uk/staticarchive/bbc_radio_1_logo_square.jpg' },
  { name: 'NPR News - Washington, DC', type: 'Live Radio', url: 'https://nprice.streamguys1.com/live.mp3', thumbnail: 'https://media.npr.org/assets/img/2020/03/12/npr-square-logo.png' },
  { name: 'CBC Radio One - Toronto', type: 'Live Radio', url: 'http://cbc_r1_tor.akacast.akamaistream.net/7/723/451661/v1/rcmp.cbc.ca/CBLA-FM', thumbnail: 'https://www.cbc.ca/radio/static/images/cbc-radio-one-logo.png' },
  { name: 'ABC News Radio - Sydney', type: 'Live Radio', url: 'http://live-radio01.mediahubaustralia.com/2RNW/mp3/', thumbnail: 'https://www.abc.net.au/radio/static/images/abc-radio-logo.png' },
  { name: 'Capital FM - London', type: 'Live Radio', url: 'http://media-ice.musicradio.com/CapitalMP3', thumbnail: 'https://media.bauerradio.com/image/upload/c_crop,g_custom,w_200,h_200/v1603456789/brandmanager/station-logos/Capital.png' },
  { name: 'KEXP - Seattle', type: 'Live Radio', url: 'http://live-mp3-128.kexp.org/kexp128.mp3', thumbnail: 'https://www.kexp.org/wp-content/uploads/2020/02/kexp-logo-square.png' },
  { name: 'WNYC - New York', type: 'Live Radio', url: 'https://fm939.wnyc.org/wnycfm', thumbnail: 'https://media.wnyc.org/i/300/300/l/80/1/wnyc-square-logo.png' },
  { name: 'RTÃ‰ Radio 1 - Dublin', type: 'Live Radio', url: 'https://www.rte.ie/manifests/radio1.m3u8', thumbnail: 'https://www.rte.ie/radio/static/images/rte-radio-1-logo.png' },
  { name: 'BBC Radio 2 - London', type: 'Live Radio', url: 'http://as-hls-uk-live.akamaized.net/pool_904/live/uk/bbc_radio_two/bbc_radio_two.isml/bbc_radio_two-audio=320000.m3u8', thumbnail: 'https://www.bbc.co.uk/staticarchive/bbc_radio_2_logo_square.jpg' },
  { name: 'KIIS 106.5 - Sydney', type: 'Live Radio', url: 'https://live.kiis1065.com.au/kiis1065.mp3', thumbnail: 'https://www.kiis1065.com.au/wp-content/uploads/2020/01/kiis1065-logo-square.png' },
  { name: 'Virgin Radio UK - London', type: 'Live Radio', url: 'http://radio.virginradio.co.uk/stream', thumbnail: 'https://virginradio.co.uk/sites/default/files/virgin-radio-logo-square.png' },
  { name: 'Triple J - Sydney', type: 'Live Radio', url: 'http://live-radio01.mediahubaustralia.com/JJJW/mp3/', thumbnail: 'https://www.abc.net.au/triplej/static/images/triple-j-logo.png' },
  { name: 'WBEZ - Chicago', type: 'Live Radio', url: 'https://stream.wbez.org/wbez128.mp3', thumbnail: 'https://www.wbez.org/static/images/wbez-logo-square.png' },
  { name: 'BBC Radio 4 - London', type: 'Live Radio', url: 'http://as-hls-uk-live.akamaized.net/pool_904/live/uk/bbc_radio_fourfm/bbc_radio_fourfm.isml/bbc_radio_fourfm-audio=320000.m3u8', thumbnail: 'https://www.bbc.co.uk/staticarchive/bbc_radio_4_logo_square.jpg' },
  { name: 'KCRW - Santa Monica', type: 'Live Radio', url: 'https://kcrw.streamguys1.com/kcrw_128k_mp3', thumbnail: 'https://www.kcrw.com/kcrw-square-logo.png' }
];

function mergeRadioStations(existing, candidates) {
  const seenUrls = new Set();
  const seenNames = new Set();

  const normalizedExisting = existing.map(station => ({
    ...station,
    thumbnail: station.thumbnail ?? station.logo ?? '',
  }));

  const merged = [];

  const upsertStation = station => {
    const urlKey = station.url.toLowerCase();
    const nameKey = station.name.toLowerCase();

    if (seenUrls.has(urlKey) || seenNames.has(nameKey)) {
      return;
    }

    seenUrls.add(urlKey);
    seenNames.add(nameKey);
    merged.push(station);
  };

  normalizedExisting.forEach(station => {
    const urlKey = station.url.toLowerCase();
    const nameKey = station.name.toLowerCase();

    seenUrls.add(urlKey);
    seenNames.add(nameKey);
    merged.push(station);
  });

  candidates.forEach(candidate => {
    const urlKey = candidate.url.toLowerCase();
    const nameKey = candidate.name.toLowerCase();

    const existingIndex = merged.findIndex(station => station.url.toLowerCase() === urlKey);
    if (existingIndex !== -1) {
      const current = merged[existingIndex];
      if ((!current.thumbnail || current.thumbnail === '') && candidate.thumbnail) {
        merged[existingIndex] = {
          ...current,
          thumbnail: candidate.thumbnail,
          logo: current.logo ?? candidate.thumbnail,
        };
      }
      return;
    }

    if (seenNames.has(nameKey)) {
      return;
    }

    upsertStation({ ...candidate });
  });

  return merged;
}

async function probeWithAudio(url, timeoutMs = 8000) {
  if (typeof Audio === 'undefined') return 'warning';

  return new Promise(resolve => {
    const audio = new Audio();
    let settled = false;
    const timer = window.setTimeout(() => {
      if (settled) return;
      settled = true;
      audio.src = '';
      resolve('warning');
    }, timeoutMs);

    const cleanup = () => {
      audio.removeEventListener('canplay', handleCanPlay);
      audio.removeEventListener('error', handleError);
      window.clearTimeout(timer);
    };

    const handleCanPlay = () => {
      if (settled) return;
      settled = true;
      cleanup();
      resolve('ok');
    };

    const handleError = () => {
      if (settled) return;
      settled = true;
      cleanup();
      resolve('failed');
    };

    audio.preload = 'none';
    audio.addEventListener('canplay', handleCanPlay, { once: true });
    audio.addEventListener('error', handleError, { once: true });
    audio.src = url;
    audio.load();
  });
}

async function probeWithFetch(url, timeoutMs = 6000) {
  if (typeof fetch === 'undefined') return 'warning';
  const controller = new AbortController();
  const timer = setTimeout(() => controller.abort(), timeoutMs);

  try {
    const response = await fetch(url, { method: 'HEAD', mode: 'no-cors', signal: controller.signal });
    clearTimeout(timer);
    if (!response || (response.status >= 400 && response.type !== 'opaque')) {
      return 'warning';
    }
    return 'ok';
  } catch (_err) {
    clearTimeout(timer);
    return 'failed';
  }
}

async function validateRadioStations(stations) {
  // Dev-only helper: run window.validateRadioStations(window.mergedRadioStations)
  // from the console or a diagnostics panel when you need to probe streams.
  const results = [];

  for (const station of stations) {
    let status = 'warning';
    let message = 'Unknown';

    try {
      const audioResult = await probeWithAudio(station.url);
      if (audioResult === 'ok') {
        status = 'ok';
        message = 'Playable (audio probe)';
      } else if (audioResult === 'failed') {
        status = 'failed';
        message = 'Audio element error';
      } else {
        const fetchResult = await probeWithFetch(station.url);
        status = fetchResult;
        message = fetchResult === 'ok' ? 'Reachable (fetch probe)' : 'Network/CORS issue';
      }
    } catch (error) {
      status = 'failed';
      message = error instanceof Error ? error.message : 'Unknown error';
    }

    results.push({ station, status, message, checkedAt: Date.now() });
  }

  return results;
}

function refreshMergedRadioStations() {
  const globalStations = (typeof window !== 'undefined' && window.radioStations) || [];
  return mergeRadioStations(globalStations, radioStationsNew);
}

const mergedRadioStations = refreshMergedRadioStations();

if (typeof window !== 'undefined') {
  window.mergedRadioStations = mergedRadioStations;
  window.refreshMergedRadioStations = () => {
    const nextMerged = refreshMergedRadioStations();
    window.mergedRadioStations = nextMerged;
    return nextMerged;
  };
  window.validateRadioStations = validateRadioStations;
  window.addEventListener('ariyo:library-ready', () => {
    window.refreshMergedRadioStations();
  });
}
